\section{Base de datos}

En esta sección se estudiará el proceso de construcción de la base de datos,
desde la elaboración de un modelo entidad-relación hasta un pequeño estudio de
normalización, pasando por el modelo relacional.

\subsection{Diagrama Entidad-Relación}

La figura \ref{fig:diagrama-e-r} representa el diagrama E-R de la base de datos
que ha sido diseñada para almacenar toda la información extraída mediante el
\textit{parser}. En ella se pueden ver en color naranja las entidades, en color
marrón las relaciones y en color verde/azul los atributos correspondientes.

\subsubsection{Entidades}

En primer lugar, se procederá a explicar la utilidad de cada una de las
entidades.

\hyphenation{RE-LA-TION-SHIP}

\noindent
\begin{tabular}{rp{12cm}}
 \hline \hline
 \multicolumn{1}{c}{\textbf{Entidad}} &
 \multicolumn{1}{c}{\textbf{Información que almacena}} \\
 \hline \hline
 Word & 
 Palabras encontradas (en su norma normalizada o en su forma natural)\\
 \hline
 Document & 
 Documentos procesados, con su título (entidad débil, forma clave con
 Collection).\\
 \hline
 DocType & 
 Tipos de documentos posibles (hasta el momento TRAIN y TEST)\\
 \hline
 Collection & 
 Colecciones completas procesadas y el nombre del fichero donde se encontraba.\\
 \hline
 Property &
 Todos los tags posibles, a nivel de palabra, clausal, frasal o de relación
 entre palabras.\\ 
 \hline
 PropertyList &
 Listas de elementos de tipo Property, para guardar los análisis a nivel frasal
 y clausal. En el ejemplo de la figura \ref{fig:arbol-sintactico}, tomando la
 palabra \textit{Debian}, la lista de propiedades a guardar sería \textit{S NP} 
 \\
 \hline
 PropType &
 Tipos de las propiedades (\begin{small}CLAUSE, WORD, PHRASE y
 RELATIONSHIP\end{small}). \\
 \hline
 Category & 
 Todas las categorías encontradas.\\
 \hline
 ParseElement &
 Almacén para cada uno de los elementos del análisis extraídos del árbol, tanto
 a nivel clausal y frasal (ver PropertyList), como a nivel de palabra (ver
 Property).\\
 \hline \hline
\end{tabular}

\subsubsection{Atributos}

Los atributos que contienen las entidades anteriores son los siguientes (se
excluyen aquellos que son utilizados como índice):

\noindent
\begin{tabular}{cccl}
 \hline \hline
 \multicolumn{1}{c}{\textbf{Entidad}} &
 \multicolumn{1}{c}{\textbf{Atributo}} &
 \multicolumn{1}{c}{\textbf{Tipo}} &
 \multicolumn{1}{c}{\textbf{Descripción}} \\
 \hline \hline
 %Word & word\_id & int & Índice\\
 %\hline
 Word & string & varchar & Contenedor de la palabra\\
 %\hline
 %Collection & collection\_id & int & Índice\\
 \hline
 Collection & name & varchar & Nombre de la colección\\
 \hline
 %Document & document\_id & int & Índice débil\\
 %\hline
 Document & title & varchar & Título del documento\\
 \hline
 %Doctype & doctype\_id & int & Índice\\
 %\hline
 Doctype & string & varchar & Contenedor del nombre del tipo de documento\\
 \hline
 %Category & category\_id & int & Índice\\
 %\hline
 Category & string & varchar & Contenedor del nombre de la categoría\\
 \hline
 %Property & property\_id & int & Índice\\
 %\hline
 Property & string & varchar & Contenedor del nombre de la propiedad\\
 \hline
 Property & description & tinytext & Descripción de la propiedad\\
 \hline
 %Proptype & proptype\_id & int & Índice\\
 %\hline
 Proptype & string & varchar & Contenedor del nombre del tipo de la propiedad\\
 \hline
 %PropertyList & propertylist\_id & int & Índice\\
 %\hline
 PropertyList & hashCode & char & Hash identificador de la lista\\
 \hline
 %ParseElement & element\_id & int & Índice\\
 %\hline
 ParseElement & fromTitle & bool & 1 si el elemento pertenece al título del
 documento\\
 \hline
 ParseElement & normalized & bool & 1 si el elemento está normalizado\\
 \hline \hline
\end{tabular}

\subsubsection{Relaciones}

La mayoría de relaciones son bastante obvias, con tan sólo echar un vistazo al
diagrama entidad-relación se puede entender su utilidad. Por esa razón en este
apartado sólo se van a comentar la relación llamada \textit{dependencies}, que
puede ser la que necesite un poco más de explicación.

La relación \textit{dependencies} está diseñada para guardar los datos relativos
a una parte de la información semántica extraída, en concreto las relaciones
gramaticales entre las palabras (véase la figura
\ref{fig:relaciones-palabras}). Como se puede observar en el diagrama E-R, es
necesario conocer que pareja de palabras está relacionada, así como que
propiedad las relaciona.

\begin{figure}[h]
\begin{center}
\includegraphics[angle=90,scale=0.425]{images/build/bdd-e-r.pdf}
\end{center}
\caption{Diagrama entidad-relación de la base de datos}
\label{fig:diagrama-e-r}
\end{figure}

\subsection{Modelo relacional}

El modelo relacional es el paso siguiente a realizar una vez hecho el diagrama
E-R, necesario para posteriormente hacer el paso a tablas y crear la lista de
sentencias SQL necesarias para crear la base de datos.

Para representarlo he utilizado las siguientes reglas. Si un atributo está en
\textbf{negrita} significa que forma parte de la clave primaria. Por otro lado,
si un atributo está \underline{subrayado} quiere decir que es una clave ajena,
que viene de la tabla que indica el superíndice.

\subsubsection{Tablas simples}

\noindent
word = (\textbf{word\_id}, string)

\noindent
collection = (\textbf{collection\_id}, name)

\noindent
doctype = (\textbf{doctype\_id}, string)

\noindent
proptype = (\textbf{proptype\_id}, string)

\noindent
category = (\textbf{category\_id}, string)

\noindent
propertylist = (\textbf{propertylist\_id}, hashCode)

% 1:N

\subsubsection{Tablas que forman parte de relaciones 1:N}

\noindent
document = (\textbf{document\_id},
\underline{\textbf{collection\_id}}$^{collection}$, 
title,
\underline{doctype\_id}$^{doctype}$)

\noindent
property = (\textbf{property\_id}, string, description,
\underline{type\_id}$^{proptype}$)

\noindent
wordpropdoc = (\textbf{propproplist\_id},
\underline{word\_id}$^{word}$,
\underline{property\_id}$^{property}$,
\underline{document\_id}$^{document}$, 
\underline{collection\_id}$^{document}$,
\underline{list\_id}$^{propertylist}$,
fromTitle,
normalized)

%N:M

\subsubsection{Tablas nuevas geneneradas por relaciones del tipo N:M}

\noindent
doccat = (\underline{\textbf{category\_id}}$^{category}$, 
\underline{\textbf{document\_id}}$^{document}$, 
\underline{\textbf{collection\_id}}$^{document}$)

\noindent
wordwordpropdoc = (\underline{\textbf{masterWord\_id}}$^{word}$,
\underline{\textbf{slaveWord\_id}}$^{word}$,
\underline{\textbf{property\_id}}$^{property}$,
\underline{\textbf{document\_id}}$^{document}$,
\underline{\textbf{collection\_id}}$^{document}$,
\textbf{fromTitle},
\textbf{normalized},
times)

\noindent
propproplist = (\underline{\textbf{list\_id}}$^{propertylist}$,
\underline{\textbf{prop\_id}}$^{property}$)

\subsection{Normalización}

¿Elena? FIXME

\subsection{Generación de la base de datos}

MIEX es capaz de, mediante un fichero de texto con sentencias SQL, construir la
base de datos antes de empezar a procesar los ficheros de entrada (véase la
opción \textit{CreateDB} del fichero de configuración). 

En el directorio \url{share/sql} está situado el fichero de sentencias SQL
necesario para construir la base de datos que se comenta en esta sección, así
como para insertar una serie de datos estáticos necesarios.

\subsection{Vistas}

Como se puede figurar después de haber leído el primer capítulo, no es objetivo
del proyecto proporcionar un interfaz de consulta de la base de datos. De todos
modos, en el directorio \url{misc/query}, se pueden encontrar dos pequeños
scripts escritos en PHP\footnote{http://www.php.net} que contienen consultas de
ejemplo que pueden ser utilizadas como base bien para usuarios finales o bien
para futuras ampliaciones. Como breve explicación, el programa
\textit{query.php} muestra una visión general de la base de datos, mientras que
el script \textit{showcat.php} permite hacer una búsqueda por categoría.

Este par de herramientas han sido utilizadas fundamentalmente para hacer pruebas
de funcionamiento por lo que, además de no considerarse funcionalidades
oficiales del proyecto, \textbf{se distribuyen sin ninguna garantía
de funcionamiento}.

